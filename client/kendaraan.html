<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="js/fbsdk.js" charset="utf-8"></script>

    <script type="text/javascript">
      function Logout () {
        localStorage.removeItem('accesstoken')
        console.log('logged out');
        document.location.href="login.html"
      }

      function removeKendaraan (id) {
        console.log('ini remove');
        $.ajax({
          method: 'delete',
          url: `http://localhost:3000/kendaraan/${id}`,
          headers: {
            token: localStorage.getItem('accesstoken'),
            fbaccesstoken: localStorage.getItem('fbaccesstoken')
          }
        })
        .done(response => {
          console.log(response);
          window.location.href="kendaraan.html"
        })
      }

      function getOneKendaraan (id) {
        $.ajax({
          method: 'get',
          url: `http://localhost:3000/kendaraan/${id}`,
          headers: {
            token: localStorage.getItem('accesstoken'),
            fbaccesstoken: localStorage.getItem('fbaccesstoken')
          }
        })
        .done(response => {
          console.log(response);
          $('#kendaraan-edit-div').empty()
          $('#kendaraan-edit-div').append(`
            <br>
            <form id="kendaraan-edit-form">
              <input style="display:none" disabled type="text" name="id" placeholder="id" required value="${response._id}">
              <input type="text" name="jenis" placeholder="jenis kendaraan" required value="${response.jenis}">
              <input type="text" name="nopolisi" placeholder="nomor polisi" required value="${response.nopolisi}">
              <button type="button" name="update-kendaraan-button" onclick="updateKendaraan('${response._id}')">update</button>
            </form>
            `)

          // window.location.href="kendaraan.html"
        })
      }

      function updateKendaraan (id) {
        $.ajax({
          method: 'put',
          url: `http://localhost:3000/kendaraan/${id}`,
          data: {
            jenis: $('#kendaraan-edit-form').find('input[name="jenis"]').val(),
            nopolisi: $('#kendaraan-edit-form').find('input[name="nopolisi"]').val()
          },
          headers: {
            token: localStorage.getItem('accesstoken'),
            fbaccesstoken: localStorage.getItem('fbaccesstoken')
          }
        })
        .done(response => {
          console.log(response);
          $('#kendaraan-edit-div').empty()
          window.location.href="kendaraan.html"
        })
      }

      $(document).ready(function () {
        if (localStorage.getItem('fbaccesstoken') == null) {
          $('#fb-logout-button').hide()
        }

        if (localStorage.getItem('accesstoken') == null) {
          $('#logout-button').hide()
        }

        $.ajax({
          method: 'get',
          url: 'http://localhost:3000/kendaraan',
          headers: {
            token: localStorage.getItem('accesstoken'),
            fbaccesstoken: localStorage.getItem('fbaccesstoken')
          }
        })
        .done(function (response) {
          if (response.,sg == 'unauthenticated') {
            alert('Autentikasi gagal')
            window.location.href="index.html"
          }
          console.log(response)
          let no = 1
          response.forEach(kendaraan => {
            $('#kendaraan-table').find('tbody').append(`
              <tr>
                <td>${no++}</td>
                <td>${kendaraan.jenis}</td>
                <td>${kendaraan.nopolisi}</td>
                <td><a href="#!" onclick="removeKendaraan('${kendaraan._id}')">DELETE</a></td>
                <td><a href="#!" onclick="getOneKendaraan('${kendaraan._id}')">UPDATE</a></td>
              </tr>
              `)
          })
        })

        $('#kendaraan-form').on('submit', function(e) {
          e.preventDefault();

          $.ajax({
            method: 'post',
            url: 'http://localhost:3000/kendaraan',
            data: {
              jenis: $('#kendaraan-form').find('input[name="jenis"]').val(),
              nopolisi: $('#kendaraan-form').find('input[name="nopolisi"]').val()
            },
            headers: {
              token: localStorage.getItem('accesstoken'),
              fbaccesstoken: localStorage.getItem('fbaccesstoken')
            }
          })
          .done(response => {
            console.log(response);
            window.location.href="kendaraan.html"
          })
        })
      })
    </script>

  </head>
  <body>
    <form id="kendaraan-form">
      <input type="text" name="jenis" placeholder="jenis kendaraan" required>
      <input type="text" name="nopolisi" placeholder="nomor polisi" required>
      <button type="submit" name="add-kendaraan-button">add</button>
    </form>
    <div id="kendaraan-edit-div">
      <!-- edit form append here -->
    </div>
    <br>
    <table border="1" id="kendaraan-table">
      <thead>
        <tr>
          <th>No</th>
          <th>Jenis Kendaraan</th>
          <th>Nomor Polisi</th>
          <th colspan="2">Options</th>
        </tr>
      </thead>
      <tbody>
        <!-- list kendaraan append here -->
        <!-- <tr>
          <td>?</td>
          <td>?</td>
          <td>?</td>
          <td><a href="#!">DELETE</a></td>
          <td><a href="#!">UPDATE</a></td>
        </tr> -->
      </tbody>
    </table>
    <br>
    <button id="logout-button" type="button" name="logout-button" onclick="Logout()">logout</button>
    <button id="fb-logout-button" type="button" name="fb-logout-button" onclick="FBLogout()">fb-logout</button>
  </body>
</html>
